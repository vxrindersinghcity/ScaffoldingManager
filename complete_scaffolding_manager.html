<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scaffolding Business Manager - Ultimate Edition</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body { 
            margin: 0; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .modal-overlay { 
            backdrop-filter: blur(8px); 
            animation: fadeIn 0.2s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .slide-up {
            animation: slideUp 0.3s ease-out;
        }
        .stat-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.2s;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        .invoice-item {
            transition: all 0.2s;
        }
        .invoice-item:hover {
            background: #f8fafc;
            border-color: #667eea;
        }
        .tab-button {
            position: relative;
            transition: all 0.3s;
        }
        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 2px 2px 0 0;
        }
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .print-only { display: none; }
        @media print {
            .no-print { display: none !important; }
            .print-only { display: block !important; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const API_URL = 'http://localhost:5000/api';

        // Enhanced Icon Components
        const Plus = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="12" y1="5" x2="12" y2="19"/>
                <line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
        );
        
        const Edit = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
            </svg>
        );
        
        const Trash = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="3 6 5 6 21 6"/>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
            </svg>
        );
        
        const Alert = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="8" x2="12" y2="12"/>
                <line x1="12" y1="16" x2="12.01" y2="16"/>
            </svg>
        );
        
        const Search = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="11" cy="11" r="8"/>
                <path d="m21 21-4.35-4.35"/>
            </svg>
        );
        
        const Download = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7 10 12 15 17 10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
        );
        
        const X = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
        );

        const Filter = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/>
            </svg>
        );

        const Printer = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="6 9 6 2 18 2 18 9"/>
                <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/>
                <rect x="6" y="14" width="12" height="8"/>
            </svg>
        );

        const History = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12 6 12 12 16 14"/>
            </svg>
        );

        function Dashboard() {
            const [activeTab, setActiveTab] = useState('invoices');
            const [invoices, setInvoices] = useState([]);
            const [inquiries, setInquiries] = useState([]);
            const [vehicles, setVehicles] = useState([]);
            
            const [showModal, setShowModal] = useState(false);
            const [modalType, setModalType] = useState('');
            const [editingItem, setEditingItem] = useState(null);
            
            // Enhanced search and filter states
            const [invoiceSearch, setInvoiceSearch] = useState('');
            const [invoiceStatusFilter, setInvoiceStatusFilter] = useState('all');
            const [inquirySearch, setInquirySearch] = useState('');
            const [inquiryStatusFilter, setInquiryStatusFilter] = useState('all');
            
            // Show filters
            const [showInvoiceFilters, setShowInvoiceFilters] = useState(false);
            const [showInquiryFilters, setShowInquiryFilters] = useState(false);
            
            // Invoice form state
            const [invoiceForm, setInvoiceForm] = useState({
                invoiceNumber: '',
                clientName: '',
                clientAddress: '',
                clientPhone: '',
                date: new Date().toISOString().split('T')[0],
                items: [{ description: '', quantity: 1, rate: 0 }],
                notes: ''
            });

            // Load data on mount
            useEffect(() => {
                loadData();
            }, []);

            const loadData = async () => {
                try {
                    const [invRes, inqRes, vehRes] = await Promise.all([
                        fetch(API_URL + '/invoices'),
                        fetch(API_URL + '/inquiries'),
                        fetch(API_URL + '/vehicles')
                    ]);
                    setInvoices(await invRes.json());
                    setInquiries(await inqRes.json());
                    setVehicles(await vehRes.json());
                } catch (error) {
                    console.error('Error loading data:', error);
                    // Fallback to empty arrays if API fails
                    setInvoices([]);
                    setInquiries([]);
                    setVehicles([]);
                }
            };

            // Enhanced filter functions
            const filteredInvoices = invoices.filter(inv => {
                const matchesSearch = inv.invoiceNumber?.toLowerCase().includes(invoiceSearch.toLowerCase()) ||
                                    inv.clientName?.toLowerCase().includes(invoiceSearch.toLowerCase());
                const matchesStatus = invoiceStatusFilter === 'all' || inv.status === invoiceStatusFilter;
                return matchesSearch && matchesStatus;
            });

            const filteredInquiries = inquiries.filter(inq => {
                const matchesSearch = inq.name?.toLowerCase().includes(inquirySearch.toLowerCase()) ||
                                    inq.phone?.toLowerCase().includes(inquirySearch.toLowerCase()) ||
                                    inq.location?.toLowerCase().includes(inquirySearch.toLowerCase());
                const matchesStatus = inquiryStatusFilter === 'all' || inq.status === inquiryStatusFilter;
                return matchesSearch && matchesStatus;
            });

            // Statistics
            const stats = {
                totalInvoices: invoices.length,
                totalRevenue: invoices.reduce((sum, inv) => sum + (inv.total || 0), 0),
                pendingInvoices: invoices.filter(inv => inv.status === 'pending').length,
                paidInvoices: invoices.filter(inv => inv.status === 'paid').length,
                newInquiries: inquiries.filter(inq => inq.status === 'new').length,
                totalInquiries: inquiries.length,
                totalVehicles: vehicles.length,
            };

            // Modal functions
            const openInvoiceModal = (item = null) => {
                if (item) {
                    const items = typeof item.items === 'string' ? JSON.parse(item.items) : item.items || [];
                    setInvoiceForm({
                        invoiceNumber: item.invoiceNumber,
                        clientName: item.clientName,
                        clientAddress: item.clientAddress || '',
                        clientPhone: item.clientPhone || '',
                        date: item.date,
                        items: items.length > 0 ? items : [{ description: '', quantity: 1, rate: 0 }],
                        notes: item.notes || ''
                    });
                    setEditingItem(item);
                } else {
                    const nextNum = `INV-${String(invoices.length + 1).padStart(4, '0')}`;
                    setInvoiceForm({
                        invoiceNumber: nextNum,
                        clientName: '',
                        clientAddress: '',
                        clientPhone: '',
                        date: new Date().toISOString().split('T')[0],
                        items: [{ description: '', quantity: 1, rate: 0 }],
                        notes: ''
                    });
                    setEditingItem(null);
                }
                setModalType('invoice');
                setShowModal(true);
            };

            const openInquiryModal = (item = null) => {
                setEditingItem(item);
                setModalType('inquiry');
                setShowModal(true);
            };

            const openVehicleModal = (item = null) => {
                setEditingItem(item);
                setModalType('vehicle');
                setShowModal(true);
            };

            const closeModal = () => {
                setShowModal(false);
                setEditingItem(null);
                setModalType('');
            };

            // Invoice functions
            const updateInvoiceField = (field, value) => {
                setInvoiceForm({ ...invoiceForm, [field]: value });
            };

            const updateInvoiceItem = (index, field, value) => {
                const newItems = [...invoiceForm.items];
                newItems[index][field] = field === 'quantity' || field === 'rate' ? parseFloat(value) || 0 : value;
                setInvoiceForm({ ...invoiceForm, items: newItems });
            };

            const addInvoiceItem = () => {
                setInvoiceForm({
                    ...invoiceForm,
                    items: [...invoiceForm.items, { description: '', quantity: 1, rate: 0 }]
                });
            };

            const removeInvoiceItem = (index) => {
                if (invoiceForm.items.length > 1) {
                    const newItems = invoiceForm.items.filter((_, i) => i !== index);
                    setInvoiceForm({ ...invoiceForm, items: newItems });
                }
            };

            const calculateTotal = () => {
                const subtotal = invoiceForm.items.reduce((sum, item) => sum + (item.quantity * item.rate), 0);
                const vat = subtotal * 0.20;
                const total = subtotal + vat;
                return { subtotal, vat, total };
            };

            const saveInvoice = async () => {
                if (!invoiceForm.clientName || !invoiceForm.invoiceNumber) {
                    alert('Please fill in all required fields');
                    return;
                }

                try {
                    const totals = calculateTotal();
                    const payload = {
                        invoiceNumber: invoiceForm.invoiceNumber,
                        clientName: invoiceForm.clientName,
                        clientAddress: invoiceForm.clientAddress,
                        clientPhone: invoiceForm.clientPhone,
                        date: invoiceForm.date,
                        status: editingItem ? editingItem.status : 'pending',
                        items: JSON.stringify(invoiceForm.items),
                        subtotal: totals.subtotal,
                        vat: totals.vat,
                        total: totals.total,
                        notes: invoiceForm.notes
                    };

                    const url = editingItem ? `${API_URL}/invoices/${editingItem.id}` : `${API_URL}/invoices`;
                    const method = editingItem ? 'PUT' : 'POST';
                    
                    const response = await fetch(url, {
                        method,
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) throw new Error('Failed to save invoice');

                    loadData();
                    closeModal();
                    alert('‚úÖ Invoice saved successfully!');
                } catch (error) {
                    console.error('Error saving invoice:', error);
                    alert('‚ùå Error saving invoice. Please try again.');
                }
            };

            const deleteInvoice = async (id) => {
                if (!confirm('‚ö†Ô∏è Are you sure you want to delete this invoice? This action cannot be undone.')) return;
                try {
                    await fetch(`${API_URL}/invoices/${id}`, { method: 'DELETE' });
                    loadData();
                    alert('‚úÖ Invoice deleted successfully');
                } catch (error) {
                    console.error('Error deleting invoice:', error);
                    alert('‚ùå Error deleting invoice');
                }
            };

            const updateInvoiceStatus = async (id, newStatus) => {
                const invoice = invoices.find(inv => inv.id === id);
                if (!invoice) return;

                try {
                    await fetch(`${API_URL}/invoices/${id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ ...invoice, status: newStatus })
                    });
                    loadData();
                } catch (error) {
                    console.error('Error updating status:', error);
                }
            };

            // Inquiry functions
            const saveInquiry = async (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                const payload = {
                    name: formData.get('name'),
                    phone: formData.get('phone'),
                    email: formData.get('email'),
                    location: formData.get('location'),
                    status: formData.get('status'),
                    date: formData.get('date'),
                    notes: formData.get('notes'),
                    quoteAmount: parseFloat(formData.get('quoteAmount')) || null
                };

                try {
                    const url = editingItem ? `${API_URL}/inquiries/${editingItem.id}` : `${API_URL}/inquiries`;
                    const method = editingItem ? 'PUT' : 'POST';
                    
                    await fetch(url, {
                        method,
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    loadData();
                    closeModal();
                    alert('‚úÖ Inquiry saved successfully!');
                } catch (error) {
                    console.error('Error saving inquiry:', error);
                    alert('‚ùå Error saving inquiry');
                }
            };

            const deleteInquiry = async (id) => {
                if (!confirm('‚ö†Ô∏è Are you sure you want to delete this inquiry?')) return;
                try {
                    await fetch(`${API_URL}/inquiries/${id}`, { method: 'DELETE' });
                    loadData();
                } catch (error) {
                    console.error('Error deleting inquiry:', error);
                }
            };

            // Vehicle functions
            const saveVehicle = async (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                const payload = {
                    registration: formData.get('registration').toUpperCase(),
                    ownerName: formData.get('ownerName'),
                    insuranceName: formData.get('insuranceName'),
                    motDue: formData.get('motDue'),
                    taxDue: formData.get('taxDue'),
                    tachoDue: formData.get('tachoDue'),
                    insuranceDue: formData.get('insuranceDue'),
                    motActioned: editingItem?.motActioned || false,
                    taxActioned: editingItem?.taxActioned || false,
                    tachoActioned: editingItem?.tachoActioned || false,
                    insuranceActioned: editingItem?.insuranceActioned || false
                };

                try {
                    const url = editingItem ? `${API_URL}/vehicles/${editingItem.id}` : `${API_URL}/vehicles`;
                    const method = editingItem ? 'PUT' : 'POST';
                    
                    await fetch(url, {
                        method,
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    loadData();
                    closeModal();
                    alert('‚úÖ Vehicle saved successfully!');
                } catch (error) {
                    console.error('Error saving vehicle:', error);
                    alert('‚ùå Error saving vehicle');
                }
            };

            const deleteVehicle = async (id) => {
                if (!confirm('‚ö†Ô∏è Are you sure you want to delete this vehicle?')) return;
                try {
                    await fetch(`${API_URL}/vehicles/${id}`, { method: 'DELETE' });
                    loadData();
                } catch (error) {
                    console.error('Error deleting vehicle:', error);
                }
            };

            const markVehicleActioned = async (vehicleId, field) => {
                const vehicle = vehicles.find(v => v.id === vehicleId);
                if (!vehicle) return;
                
                try {
                    await fetch(`${API_URL}/vehicles/${vehicleId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ ...vehicle, [field]: true })
                    });
                    loadData();
                } catch (error) {
                    console.error('Error updating vehicle:', error);
                }
            };

            // Excel Export with enhanced formatting
            const exportToExcel = (type) => {
                try {
                    let data, filename, sheetName;
                    
                    if (type === 'invoices') {
                        data = filteredInvoices.map(inv => ({
                            'Invoice Number': inv.invoiceNumber,
                            'Client Name': inv.clientName,
                            'Date': inv.date,
                            'Subtotal': inv.subtotal?.toFixed(2) || '0.00',
                            'VAT (20%)': inv.vat?.toFixed(2) || '0.00',
                            'Total': inv.total?.toFixed(2) || '0.00',
                            'Status': inv.status?.toUpperCase(),
                            'Notes': inv.notes || ''
                        }));
                        filename = `Invoices_${new Date().toISOString().split('T')[0]}.xlsx`;
                        sheetName = 'Invoices';
                    } else if (type === 'inquiries') {
                        data = filteredInquiries.map(inq => ({
                            'Name': inq.name,
                            'Phone': inq.phone,
                            'Email': inq.email || '',
                            'Location': inq.location,
                            'Status': inq.status?.toUpperCase(),
                            'Date': inq.date,
                            'Quote Amount': inq.quoteAmount ? `¬£${inq.quoteAmount}` : '',
                            'Notes': inq.notes || ''
                        }));
                        filename = `Inquiries_${new Date().toISOString().split('T')[0]}.xlsx`;
                        sheetName = 'Inquiries';
                    } else if (type === 'vehicles') {
                        data = vehicles.map(veh => ({
                            'Registration': veh.registration,
                            'Owner Name': veh.ownerName,
                            'Insurance Company': veh.insuranceName || '',
                            'MOT Due': veh.motDue,
                            'Tax Due': veh.taxDue,
                            'Tacho Due': veh.tachoDue,
                            'Insurance Due': veh.insuranceDue
                        }));
                        filename = `Vehicles_${new Date().toISOString().split('T')[0]}.xlsx`;
                        sheetName = 'Vehicles';
                    }

                    const ws = XLSX.utils.json_to_sheet(data);
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, sheetName);
                    XLSX.writeFile(wb, filename);
                    
                    alert(`‚úÖ Exported ${data.length} records to ${filename}`);
                } catch (error) {
                    console.error('Export error:', error);
                    alert('‚ùå Error exporting to Excel');
                }
            };

            // PDF Generation for invoices
            const generateInvoicePDF = async (invoice) => {
                try {
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();
                    
                    // Company Header
                    doc.setFontSize(20);
                    doc.setTextColor(102, 126, 234);
                    doc.setFont(undefined, 'bold');
                    doc.text('Khalsa Scaffolding LTD', 20, 15);
                    
                    doc.setFontSize(9);
                    doc.setTextColor(0, 0, 0);
                    doc.setFont(undefined, 'normal');
                    doc.text('66 Raynton Drive', 20, 22);
                    doc.text('Hayes UB4 8BE', 20, 27);
                    doc.text('Phone: 07741252013', 20, 32);
                    
                    // INVOICE Title (right side)
                    doc.setFontSize(24);
                    doc.setTextColor(102, 126, 234);
                    doc.setFont(undefined, 'bold');
                    doc.text('INVOICE', 160, 15);
                    
                    // Invoice details (right side)
                    doc.setFontSize(10);
                    doc.setTextColor(0, 0, 0);
                    doc.setFont(undefined, 'bold');
                    doc.text('INVOICE #:', 140, 25);
                    doc.text('DATE:', 140, 30);
                    doc.setFont(undefined, 'normal');
                    doc.text(invoice.invoiceNumber, 165, 25);
                    doc.text(invoice.date, 165, 30);
                    
                    // Terms (right side)
                    doc.setFontSize(9);
                    doc.text('TERMS: Due Upon Receipt', 140, 35);
                    
                    // Client details (BILL TO)
                    doc.setFontSize(11);
                    doc.setFont(undefined, 'bold');
                    doc.text('BILL TO:', 20, 45);
                    doc.setFontSize(10);
                    doc.setFont(undefined, 'normal');
                    doc.text(invoice.clientName, 20, 52);
                    if (invoice.clientAddress) doc.text(invoice.clientAddress, 20, 57);
                    if (invoice.clientPhone) doc.text(invoice.clientPhone, 20, 62);
                    
                    // Items table
                    const items = typeof invoice.items === 'string' ? JSON.parse(invoice.items) : invoice.items;
                    let yPos = 75;
                    
                    // Table Header
                    doc.setFillColor(240, 240, 240);
                    doc.rect(20, yPos - 5, 170, 8, 'F');
                    doc.setFontSize(10);
                    doc.setFont(undefined, 'bold');
                    doc.text('DESCRIPTION', 22, yPos);
                    doc.text('QTY', 120, yPos);
                    doc.text('UNIT PRICE', 140, yPos);
                    doc.text('AMOUNT', 170, yPos);
                    
                    yPos += 3;
                    doc.setLineWidth(0.5);
                    doc.line(20, yPos, 190, yPos);
                    
                    yPos += 7;
                    doc.setFont(undefined, 'normal');
                    items.forEach(item => {
                        doc.text(item.description.substring(0, 40), 22, yPos);
                        doc.text(String(item.quantity), 125, yPos, { align: 'right' });
                        doc.text(`¬£${item.rate.toFixed(2)}`, 155, yPos, { align: 'right' });
                        doc.text(`¬£${(item.quantity * item.rate).toFixed(2)}`, 185, yPos, { align: 'right' });
                        yPos += 7;
                    });
                    
                    // Totals
                    yPos += 5;
                    doc.setLineWidth(0.5);
                    doc.line(20, yPos, 190, yPos);
                    yPos += 8;
                    
                    doc.setFont(undefined, 'normal');
                    doc.text('SUBTOTAL:', 140, yPos);
                    doc.text(`¬£${invoice.subtotal?.toFixed(2) || '0.00'}`, 185, yPos, { align: 'right' });
                    yPos += 7;
                    
                    doc.text('TAX RATE:', 140, yPos);
                    doc.text('20%', 185, yPos, { align: 'right' });
                    yPos += 7;
                    
                    doc.text('VAT:', 140, yPos);
                    doc.text(`¬£${invoice.vat?.toFixed(2) || '0.00'}`, 185, yPos, { align: 'right' });
                    yPos += 7;
                    
                    doc.setLineWidth(1);
                    doc.line(135, yPos, 190, yPos);
                    yPos += 8;
                    
                    doc.setFontSize(12);
                    doc.setFont(undefined, 'bold');
                    doc.text('TOTAL:', 140, yPos);
                    doc.text(`¬£${invoice.total?.toFixed(2) || '0.00'}`, 185, yPos, { align: 'right' });
                    
                    // Thank you message
                    yPos += 15;
                    doc.setFontSize(11);
                    doc.setFont(undefined, 'bold');
                    doc.setTextColor(102, 126, 234);
                    doc.text('Thank you for your business!', 105, yPos, { align: 'center' });
                    
                    // Bank details
                    yPos += 10;
                    doc.setFontSize(9);
                    doc.setTextColor(0, 0, 0);
                    doc.setFont(undefined, 'bold');
                    doc.text('Bank Details:', 20, yPos);
                    doc.setFont(undefined, 'normal');
                    yPos += 5;
                    doc.text('Bank name: Khalsa Scaffolding LTD', 20, yPos);
                    yPos += 5;
                    doc.text('Account number: 33189759', 20, yPos);
                    yPos += 5;
                    doc.text('Sort code: 20-42-76', 20, yPos);
                    
                    // Company registration
                    yPos += 8;
                    doc.setFontSize(8);
                    doc.setTextColor(100, 100, 100);
                    doc.text('Company number: 13490441 | VAT: 437471907', 105, yPos, { align: 'center' });
                    
                    // Contact info
                    yPos += 8;
                    doc.setFontSize(9);
                    doc.setTextColor(0, 0, 0);
                    doc.text('If you have any questions about this invoice, please contact:', 105, yPos, { align: 'center' });
                    yPos += 5;
                    doc.setFont(undefined, 'bold');
                    doc.text('Jagtar Singh Brar, 07741252013', 105, yPos, { align: 'center' });
                    
                    // Notes
                    if (invoice.notes) {
                        yPos += 10;
                        doc.setFontSize(9);
                        doc.setFont(undefined, 'bold');
                        doc.text('Notes:', 20, yPos);
                        doc.setFont(undefined, 'normal');
                        const splitNotes = doc.splitTextToSize(invoice.notes, 170);
                        doc.text(splitNotes, 20, yPos + 5);
                    }
                    
                    doc.save(`Invoice_${invoice.invoiceNumber}.pdf`);
                    alert('‚úÖ PDF generated successfully!');
                } catch (error) {
                    console.error('PDF generation error:', error);
                    alert('‚ùå Error generating PDF. Make sure jsPDF library is loaded.');
                }
            };

            // Vehicle reminders with enhanced logic
            const getReminders = () => {
                const today = new Date();
                const reminders = [];

                vehicles.forEach(veh => {
                    const checkDate = (dateStr, type, days, actioned) => {
                        if (actioned) return;
                        const date = new Date(dateStr);
                        const daysUntil = Math.ceil((date - today) / (1000 * 60 * 60 * 24));
                        
                        if (daysUntil <= days) {
                            reminders.push({
                                vehicleId: veh.id,
                                vehicle: `${veh.registration} (Owner: ${veh.ownerName || 'N/A'})`,
                                type,
                                daysUntil,
                                isOverdue: daysUntil < 0,
                                isUrgent: daysUntil <= 7 && daysUntil >= 0,
                                actionField: type === 'MOT' ? 'motActioned' : 
                                           type === 'Tax' ? 'taxActioned' : 
                                           type === 'Tacho' ? 'tachoActioned' :
                                           'insuranceActioned'
                            });
                        }
                    };

                    checkDate(veh.motDue, 'MOT', 30, veh.motActioned);
                    checkDate(veh.taxDue, 'Tax', 14, veh.taxActioned);
                    checkDate(veh.tachoDue, 'Tacho', 30, veh.tachoActioned);
                    checkDate(veh.insuranceDue, 'Insurance', 60, veh.insuranceActioned);
                });

                return reminders.sort((a, b) => a.daysUntil - b.daysUntil);
            };

            const reminders = getReminders();

            // Status badge helper
            const getStatusBadge = (status, type = 'invoice') => {
                const styles = {
                    invoice: {
                        paid: 'bg-green-100 text-green-800',
                        pending: 'bg-yellow-100 text-yellow-800',
                        overdue: 'bg-red-100 text-red-800'
                    },
                    inquiry: {
                        new: 'bg-blue-100 text-blue-800',
                        contacted: 'bg-yellow-100 text-yellow-800',
                        quoted: 'bg-purple-100 text-purple-800',
                        completed: 'bg-green-100 text-green-800'
                    }
                };

                const colorClass = styles[type]?.[status] || 'bg-gray-100 text-gray-800';
                return <span className={`status-badge ${colorClass}`}>{status?.toUpperCase()}</span>;
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-50 to-blue-50">
                    <div className="container mx-auto p-4 md:p-6">
                        {/* Enhanced Header */}
                        <div className="mb-8 slide-up">
                            <div className="bg-white rounded-2xl shadow-xl p-6 md:p-8" style={{
                                background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'
                            }}>
                                <h1 className="text-3xl md:text-5xl font-bold text-white mb-3 flex items-center gap-3">
                                    üèóÔ∏è Scaffolding Business Manager
                                </h1>
                                <p className="text-white/90 text-lg">Complete business management system - Ultimate Edition</p>
                            </div>
                        </div>

                        {/* Enhanced Statistics */}
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                            <div className="stat-card bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-500">
                                <p className="text-slate-600 text-sm font-semibold uppercase tracking-wide">Total Invoices</p>
                                <p className="text-3xl font-bold text-slate-800 mt-2">{stats.totalInvoices}</p>
                                <p className="text-xs text-slate-500 mt-2">
                                    ¬£{stats.totalRevenue.toFixed(2)} total revenue
                                </p>
                            </div>
                            <div className="stat-card bg-white rounded-xl shadow-lg p-6 border-l-4 border-green-500">
                                <p className="text-slate-600 text-sm font-semibold uppercase tracking-wide">Paid Invoices</p>
                                <p className="text-3xl font-bold text-green-600 mt-2">{stats.paidInvoices}</p>
                                <p className="text-xs text-slate-500 mt-2">
                                    {stats.pendingInvoices} pending payment
                                </p>
                            </div>
                            <div className="stat-card bg-white rounded-xl shadow-lg p-6 border-l-4 border-purple-500">
                                <p className="text-slate-600 text-sm font-semibold uppercase tracking-wide">New Inquiries</p>
                                <p className="text-3xl font-bold text-purple-600 mt-2">{stats.newInquiries}</p>
                                <p className="text-xs text-slate-500 mt-2">
                                    {stats.totalInquiries} total inquiries
                                </p>
                            </div>
                            <div className="stat-card bg-white rounded-xl shadow-lg p-6 border-l-4 border-red-500">
                                <p className="text-slate-600 text-sm font-semibold uppercase tracking-wide">Vehicle Reminders</p>
                                <p className="text-3xl font-bold text-red-600 mt-2">{reminders.length}</p>
                                <p className="text-xs text-slate-500 mt-2">
                                    {stats.totalVehicles} vehicles tracked
                                </p>
                            </div>
                        </div>

                        {/* Enhanced Reminders */}
                        {reminders.length > 0 && (
                            <div className="mb-8 slide-up">
                                <div className="bg-gradient-to-r from-orange-50 to-red-50 border-l-4 border-orange-500 p-6 rounded-xl shadow-lg">
                                    <div className="flex items-start">
                                        <div className="flex-shrink-0">
                                            <Alert />
                                        </div>
                                        <div className="flex-1 ml-4">
                                            <h3 className="font-bold text-orange-900 text-lg mb-4 flex items-center gap-2">
                                                ‚ö†Ô∏è Vehicle Reminders ({reminders.length})
                                            </h3>
                                            <div className="space-y-3">
                                                {reminders.map((r, i) => (
                                                    <div 
                                                        key={i} 
                                                        className={`p-4 rounded-lg shadow-sm ${
                                                            r.isOverdue ? 'bg-red-100 border border-red-300' : 
                                                            r.isUrgent ? 'bg-orange-100 border border-orange-300' : 
                                                            'bg-yellow-50 border border-yellow-200'
                                                        }`}
                                                    >
                                                        <div className="flex justify-between items-center">
                                                            <div className="flex-1">
                                                                <p className="font-semibold text-gray-900">{r.vehicle} - {r.type}</p>
                                                                <p className={`text-sm font-medium mt-1 ${
                                                                    r.isOverdue ? 'text-red-700' : 
                                                                    r.isUrgent ? 'text-orange-700' : 
                                                                    'text-yellow-700'
                                                                }`}>
                                                                    {r.isOverdue ? 
                                                                        `üö® OVERDUE by ${Math.abs(r.daysUntil)} days!` : 
                                                                        r.isUrgent ?
                                                                        `‚è∞ URGENT: Due in ${r.daysUntil} days` :
                                                                        `üìÖ Due in ${r.daysUntil} days`
                                                                    }
                                                                </p>
                                                            </div>
                                                            <button
                                                                onClick={() => markVehicleActioned(r.vehicleId, r.actionField)}
                                                                className="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition flex items-center gap-2 font-semibold"
                                                            >
                                                                ‚úì Mark Done
                                                            </button>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Main Content Card */}
                        <div className="bg-white rounded-2xl shadow-xl overflow-hidden">
                            {/* Enhanced Tabs */}
                            <div className="flex border-b bg-gradient-to-r from-gray-50 to-gray-100">
                                <button
                                    onClick={() => setActiveTab('invoices')}
                                    className={`tab-button flex-1 py-4 px-6 font-semibold transition ${
                                        activeTab === 'invoices' 
                                            ? 'active text-purple-600 bg-white' 
                                            : 'text-slate-600 hover:bg-white/50'
                                    }`}
                                >
                                    <span className="flex items-center justify-center gap-2">
                                        üìÑ Invoices <span className="text-xs bg-purple-100 text-purple-600 px-2 py-1 rounded-full">{stats.totalInvoices}</span>
                                    </span>
                                </button>
                                <button
                                    onClick={() => setActiveTab('inquiries')}
                                    className={`tab-button flex-1 py-4 px-6 font-semibold transition ${
                                        activeTab === 'inquiries' 
                                            ? 'active text-purple-600 bg-white' 
                                            : 'text-slate-600 hover:bg-white/50'
                                    }`}
                                >
                                    <span className="flex items-center justify-center gap-2">
                                        üë• Inquiries <span className="text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded-full">{stats.totalInquiries}</span>
                                    </span>
                                </button>
                                <button
                                    onClick={() => setActiveTab('vehicles')}
                                    className={`tab-button flex-1 py-4 px-6 font-semibold transition ${
                                        activeTab === 'vehicles' 
                                            ? 'active text-purple-600 bg-white' 
                                            : 'text-slate-600 hover:bg-white/50'
                                    }`}
                                >
                                    <span className="flex items-center justify-center gap-2">
                                        üöó Vehicles <span className="text-xs bg-green-100 text-green-600 px-2 py-1 rounded-full">{stats.totalVehicles}</span>
                                    </span>
                                </button>
                            </div>

                            {/* INVOICES TAB */}
                            {activeTab === 'invoices' && (
                                <div className="p-6">
                                    {/* Enhanced Header with Actions */}
                                    <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                                        <div>
                                            <h2 className="text-2xl font-bold text-gray-800">Invoices Management</h2>
                                            <p className="text-sm text-gray-600 mt-1">Create, manage, and export invoices</p>
                                        </div>
                                        <div className="flex flex-wrap gap-2">
                                            <button
                                                onClick={() => setShowInvoiceFilters(!showInvoiceFilters)}
                                                className="bg-gray-100 text-gray-700 px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-gray-200 transition"
                                            >
                                                <Filter /> Filters
                                            </button>
                                            <button
                                                onClick={() => exportToExcel('invoices')}
                                                className="bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-green-700 transition"
                                            >
                                                <Download /> Export Excel
                                            </button>
                                            <button
                                                onClick={() => openInvoiceModal()}
                                                className="btn-primary text-white px-6 py-2 rounded-lg flex items-center gap-2 font-semibold"
                                            >
                                                <Plus /> Create Invoice
                                            </button>
                                        </div>
                                    </div>

                                    {/* Enhanced Search and Filters */}
                                    <div className="space-y-4 mb-6">
                                        <div className="relative">
                                            <div className="absolute left-3 top-3 text-gray-400">
                                                <Search />
                                            </div>
                                            <input
                                                type="text"
                                                placeholder="Search by invoice number or client name..."
                                                value={invoiceSearch}
                                                onChange={(e) => setInvoiceSearch(e.target.value)}
                                                className="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                            />
                                        </div>

                                        {showInvoiceFilters && (
                                            <div className="bg-gray-50 p-4 rounded-lg border">
                                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                    <div>
                                                        <label className="block text-sm font-semibold text-gray-700 mb-2">Status Filter</label>
                                                        <select
                                                            value={invoiceStatusFilter}
                                                            onChange={(e) => setInvoiceStatusFilter(e.target.value)}
                                                            className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                                        >
                                                            <option value="all">All Statuses</option>
                                                            <option value="pending">Pending</option>
                                                            <option value="paid">Paid</option>
                                                            <option value="overdue">Overdue</option>
                                                        </select>
                                                    </div>
                                                    <div className="flex items-end">
                                                        <button
                                                            onClick={() => {
                                                                setInvoiceStatusFilter('all');
                                                                setInvoiceSearch('');
                                                            }}
                                                            className="text-purple-600 hover:text-purple-800 font-semibold"
                                                        >
                                                            Clear Filters
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                    </div>

                                    {/* Enhanced Invoice List */}
                                    <div className="space-y-3">
                                        {filteredInvoices.length === 0 ? (
                                            <div className="text-center py-16 bg-gray-50 rounded-xl">
                                                <div className="text-6xl mb-4">üìÑ</div>
                                                <p className="text-xl font-semibold text-gray-700 mb-2">No invoices found</p>
                                                <p className="text-gray-500 mb-4">Create your first invoice to get started!</p>
                                                <button
                                                    onClick={() => openInvoiceModal()}
                                                    className="btn-primary text-white px-6 py-3 rounded-lg inline-flex items-center gap-2"
                                                >
                                                    <Plus /> Create First Invoice
                                                </button>
                                            </div>
                                        ) : (
                                            filteredInvoices.map(inv => (
                                                <div key={inv.id} className="invoice-item p-5 bg-white rounded-xl border-2 border-gray-200 hover:shadow-lg transition">
                                                    <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                                                        <div className="flex-1">
                                                            <div className="flex items-center gap-3 mb-2">
                                                                <span className="font-mono text-lg font-bold text-purple-600">{inv.invoiceNumber}</span>
                                                                {getStatusBadge(inv.status, 'invoice')}
                                                            </div>
                                                            <p className="font-semibold text-gray-800 text-lg">{inv.clientName}</p>
                                                            <div className="flex flex-wrap gap-4 text-sm text-gray-600 mt-2">
                                                                <span>üìÖ {inv.date}</span>
                                                                <span className="font-bold text-green-600">üí∞ ¬£{inv.total?.toFixed(2)}</span>
                                                            </div>
                                                        </div>
                                                        <div className="flex flex-wrap items-center gap-2">
                                                            <select
                                                                value={inv.status}
                                                                onChange={(e) => updateInvoiceStatus(inv.id, e.target.value)}
                                                                className="px-3 py-2 border rounded-lg text-sm focus:ring-2 focus:ring-purple-500"
                                                            >
                                                                <option value="pending">Pending</option>
                                                                <option value="paid">Paid</option>
                                                                <option value="overdue">Overdue</option>
                                                            </select>
                                                            <button
                                                                onClick={() => generateInvoicePDF(inv)}
                                                                className="bg-blue-500 text-white p-2 rounded-lg hover:bg-blue-600 transition"
                                                                title="Download PDF"
                                                            >
                                                                <Printer />
                                                            </button>
                                                            <button
                                                                onClick={() => openInvoiceModal(inv)}
                                                                className="bg-purple-500 text-white p-2 rounded-lg hover:bg-purple-600 transition"
                                                                title="Edit"
                                                            >
                                                                <Edit />
                                                            </button>
                                                            <button
                                                                onClick={() => deleteInvoice(inv.id)}
                                                                className="bg-red-500 text-white p-2 rounded-lg hover:bg-red-600 transition"
                                                                title="Delete"
                                                            >
                                                                <Trash />
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))
                                        )}
                                    </div>
                                </div>
                            )}

                            {/* INQUIRIES TAB */}
                            {activeTab === 'inquiries' && (
                                <div className="p-6">
                                    <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                                        <div>
                                            <h2 className="text-2xl font-bold text-gray-800">Inquiries Management</h2>
                                            <p className="text-sm text-gray-600 mt-1">Track and manage customer inquiries</p>
                                        </div>
                                        <div className="flex flex-wrap gap-2">
                                            <button
                                                onClick={() => setShowInquiryFilters(!showInquiryFilters)}
                                                className="bg-gray-100 text-gray-700 px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-gray-200 transition"
                                            >
                                                <Filter /> Filters
                                            </button>
                                            <button
                                                onClick={() => exportToExcel('inquiries')}
                                                className="bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-green-700 transition"
                                            >
                                                <Download /> Export Excel
                                            </button>
                                            <button
                                                onClick={() => openInquiryModal()}
                                                className="btn-primary text-white px-6 py-2 rounded-lg flex items-center gap-2 font-semibold"
                                            >
                                                <Plus /> New Inquiry
                                            </button>
                                        </div>
                                    </div>

                                    {/* Search and Filters */}
                                    <div className="space-y-4 mb-6">
                                        <div className="relative">
                                            <div className="absolute left-3 top-3 text-gray-400">
                                                <Search />
                                            </div>
                                            <input
                                                type="text"
                                                placeholder="Search by name, phone, or location..."
                                                value={inquirySearch}
                                                onChange={(e) => setInquirySearch(e.target.value)}
                                                className="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                            />
                                        </div>

                                        {showInquiryFilters && (
                                            <div className="bg-gray-50 p-4 rounded-lg border">
                                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                    <div>
                                                        <label className="block text-sm font-semibold text-gray-700 mb-2">Status Filter</label>
                                                        <select
                                                            value={inquiryStatusFilter}
                                                            onChange={(e) => setInquiryStatusFilter(e.target.value)}
                                                            className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500"
                                                        >
                                                            <option value="all">All Statuses</option>
                                                            <option value="new">New</option>
                                                            <option value="contacted">Contacted</option>
                                                            <option value="quoted">Quoted</option>
                                                            <option value="completed">Completed</option>
                                                        </select>
                                                    </div>
                                                    <div className="flex items-end">
                                                        <button
                                                            onClick={() => {
                                                                setInquiryStatusFilter('all');
                                                                setInquirySearch('');
                                                            }}
                                                            className="text-purple-600 hover:text-purple-800 font-semibold"
                                                        >
                                                            Clear Filters
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                    </div>

                                    {/* Inquiry List */}
                                    <div className="space-y-4">
                                        {filteredInquiries.length === 0 ? (
                                            <div className="text-center py-16 bg-gray-50 rounded-xl">
                                                <div className="text-6xl mb-4">üë•</div>
                                                <p className="text-xl font-semibold text-gray-700 mb-2">No inquiries found</p>
                                                <p className="text-gray-500 mb-4">Add your first inquiry to start tracking leads!</p>
                                                <button
                                                    onClick={() => openInquiryModal()}
                                                    className="btn-primary text-white px-6 py-3 rounded-lg inline-flex items-center gap-2"
                                                >
                                                    <Plus /> Add First Inquiry
                                                </button>
                                            </div>
                                        ) : (
                                            filteredInquiries.map(inq => (
                                                <div key={inq.id} className="p-5 bg-white rounded-xl border-2 border-gray-200 hover:shadow-lg transition">
                                                    <div className="flex flex-col md:flex-row justify-between items-start gap-4">
                                                        <div className="flex-1">
                                                            <div className="flex items-center gap-3 mb-3">
                                                                <h3 className="font-bold text-xl text-gray-800">{inq.name}</h3>
                                                                {getStatusBadge(inq.status, 'inquiry')}
                                                            </div>
                                                            <div className="space-y-2 text-gray-600">
                                                                <p className="flex items-center gap-2">üìû <span>{inq.phone}</span></p>
                                                                {inq.email && <p className="flex items-center gap-2">‚úâÔ∏è <span>{inq.email}</span></p>}
                                                                <p className="flex items-center gap-2">üìç <span>{inq.location}</span></p>
                                                                <p className="flex items-center gap-2">üìÖ <span>{inq.date}</span></p>
                                                                {inq.quoteAmount && (
                                                                    <p className="flex items-center gap-2 font-bold text-green-600">
                                                                        üí∞ Quote: ¬£{inq.quoteAmount}
                                                                    </p>
                                                                )}
                                                            </div>
                                                            {inq.notes && (
                                                                <div className="mt-3 p-3 bg-blue-50 rounded-lg border-l-4 border-blue-500">
                                                                    <p className="text-sm text-gray-700">{inq.notes}</p>
                                                                </div>
                                                            )}
                                                        </div>
                                                        <div className="flex gap-2">
                                                            <button
                                                                onClick={() => openInquiryModal(inq)}
                                                                className="bg-purple-500 text-white p-2 rounded-lg hover:bg-purple-600 transition"
                                                                title="Edit"
                                                            >
                                                                <Edit />
                                                            </button>
                                                            <button
                                                                onClick={() => deleteInquiry(inq.id)}
                                                                className="bg-red-500 text-white p-2 rounded-lg hover:bg-red-600 transition"
                                                                title="Delete"
                                                            >
                                                                <Trash />
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))
                                        )}
                                    </div>
                                </div>
                            )}

                            {/* VEHICLES TAB */}
                            {activeTab === 'vehicles' && (
                                <div className="p-6">
                                    <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                                        <div>
                                            <h2 className="text-2xl font-bold text-gray-800">Fleet Vehicles</h2>
                                            <p className="text-sm text-gray-600 mt-1">Track MOT, tax, and insurance dates</p>
                                        </div>
                                        <div className="flex flex-wrap gap-2">
                                            <button
                                                onClick={() => exportToExcel('vehicles')}
                                                className="bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-green-700 transition"
                                            >
                                                <Download /> Export Excel
                                            </button>
                                            <button
                                                onClick={() => openVehicleModal()}
                                                className="btn-primary text-white px-6 py-2 rounded-lg flex items-center gap-2 font-semibold"
                                            >
                                                <Plus /> Add Vehicle
                                            </button>
                                        </div>
                                    </div>

                                    {/* Vehicle List */}
                                    <div className="space-y-4">
                                        {vehicles.length === 0 ? (
                                            <div className="text-center py-16 bg-gray-50 rounded-xl">
                                                <div className="text-6xl mb-4">üöó</div>
                                                <p className="text-xl font-semibold text-gray-700 mb-2">No vehicles found</p>
                                                <p className="text-gray-500 mb-4">Add your first vehicle to track important dates!</p>
                                                <button
                                                    onClick={() => openVehicleModal()}
                                                    className="btn-primary text-white px-6 py-3 rounded-lg inline-flex items-center gap-2"
                                                >
                                                    <Plus /> Add First Vehicle
                                                </button>
                                            </div>
                                        ) : (
                                            vehicles.map(veh => (
                                                <div key={veh.id} className="p-5 bg-white rounded-xl border-2 border-gray-200 hover:shadow-lg transition">
                                                    <div className="flex flex-col md:flex-row justify-between items-start gap-4 mb-4">
                                                        <div>
                                                            <h3 className="font-bold text-2xl text-gray-800 mb-2">{veh.registration}</h3>
                                                            <p className="text-lg text-gray-600">Owner: {veh.ownerName}</p>
                                                            {veh.insuranceName && <p className="text-sm text-gray-500">Insurance: {veh.insuranceName}</p>}
                                                        </div>
                                                        <div className="flex gap-2">
                                                            <button
                                                                onClick={() => openVehicleModal(veh)}
                                                                className="bg-purple-500 text-white p-2 rounded-lg hover:bg-purple-600 transition"
                                                                title="Edit"
                                                            >
                                                                <Edit />
                                                            </button>
                                                            <button
                                                                onClick={() => deleteVehicle(veh.id)}
                                                                className="bg-red-500 text-white p-2 rounded-lg hover:bg-red-600 transition"
                                                                title="Delete"
                                                            >
                                                                <Trash />
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <div className="grid grid-cols-1 md:grid-cols-4 gap-3">
                                                        <div className="p-4 bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg border-l-4 border-blue-500">
                                                            <p className="text-xs text-blue-700 font-semibold uppercase tracking-wide mb-1">MOT Due</p>
                                                            <p className="font-bold text-lg text-blue-900">{veh.motDue}</p>
                                                        </div>
                                                        <div className="p-4 bg-gradient-to-br from-green-50 to-green-100 rounded-lg border-l-4 border-green-500">
                                                            <p className="text-xs text-green-700 font-semibold uppercase tracking-wide mb-1">Tax Due</p>
                                                            <p className="font-bold text-lg text-green-900">{veh.taxDue}</p>
                                                        </div>
                                                        <div className="p-4 bg-gradient-to-br from-orange-50 to-orange-100 rounded-lg border-l-4 border-orange-500">
                                                            <p className="text-xs text-orange-700 font-semibold uppercase tracking-wide mb-1">Tacho Due</p>
                                                            <p className="font-bold text-lg text-orange-900">{veh.tachoDue}</p>
                                                        </div>
                                                        <div className="p-4 bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg border-l-4 border-purple-500">
                                                            <p className="text-xs text-purple-700 font-semibold uppercase tracking-wide mb-1">Insurance Due</p>
                                                            <p className="font-bold text-lg text-purple-900">{veh.insuranceDue}</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))
                                        )}
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>

                    {/* MODAL */}
                    {showModal && (
                        <div className="fixed inset-0 bg-black/60 modal-overlay flex items-center justify-center p-4 z-50">
                            <div className="bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-y-auto slide-up">
                                <div className="sticky top-0 bg-gradient-to-r from-purple-600 to-purple-800 text-white p-6 rounded-t-2xl z-10">
                                    <div className="flex justify-between items-center">
                                        <h2 className="text-2xl font-bold">
                                            {modalType === 'invoice' && (editingItem ? '‚úèÔ∏è Edit Invoice' : '‚ûï Create Invoice')}
                                            {modalType === 'inquiry' && (editingItem ? '‚úèÔ∏è Edit Inquiry' : '‚ûï New Inquiry')}
                                            {modalType === 'vehicle' && (editingItem ? '‚úèÔ∏è Edit Vehicle' : '‚ûï Add Vehicle')}
                                        </h2>
                                        <button 
                                            onClick={closeModal} 
                                            className="text-white/90 hover:text-white hover:bg-white/20 p-2 rounded-lg transition"
                                        >
                                            <X />
                                        </button>
                                    </div>
                                </div>

                                <div className="p-6">
                                    {/* INVOICE FORM */}
                                    {modalType === 'invoice' && (
                                        <div className="space-y-6">
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div>
                                                    <label className="block text-sm font-bold text-gray-700 mb-2">Invoice Number *</label>
                                                    <input
                                                        type="text"
                                                        value={invoiceForm.invoiceNumber}
                                                        onChange={(e) => updateInvoiceField('invoiceNumber', e.target.value)}
                                                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                        required
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-bold text-gray-700 mb-2">Date *</label>
                                                    <input
                                                        type="date"
                                                        value={invoiceForm.date}
                                                        onChange={(e) => updateInvoiceField('date', e.target.value)}
                                                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                        required
                                                    />
                                                </div>
                                            </div>

                                            <div>
                                                <label className="block text-sm font-bold text-gray-700 mb-2">Client Name *</label>
                                                <input
                                                    type="text"
                                                    value={invoiceForm.clientName}
                                                    onChange={(e) => updateInvoiceField('clientName', e.target.value)}
                                                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                    required
                                                    placeholder="Enter client name"
                                                />
                                            </div>

                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div>
                                                    <label className="block text-sm font-bold text-gray-700 mb-2">Address</label>
                                                    <input
                                                        type="text"
                                                        value={invoiceForm.clientAddress}
                                                        onChange={(e) => updateInvoiceField('clientAddress', e.target.value)}
                                                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                        placeholder="Client address"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-bold text-gray-700 mb-2">Phone</label>
                                                    <input
                                                        type="text"
                                                        value={invoiceForm.clientPhone}
                                                        onChange={(e) => updateInvoiceField('clientPhone', e.target.value)}
                                                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                        placeholder="Contact number"
                                                    />
                                                </div>
                                            </div>

                                            <div>
                                                <div className="flex justify-between items-center mb-3">
                                                    <label className="block text-sm font-bold text-gray-700">Line Items *</label>
                                                    <button
                                                        onClick={addInvoiceItem}
                                                        className="text-purple-600 hover:text-purple-800 text-sm flex items-center gap-1 font-semibold"
                                                    >
                                                        <Plus /> Add Item
                                                    </button>
                                                </div>
                                                <div className="space-y-3">
                                                    {invoiceForm.items.map((item, i) => (
                                                        <div key={i} className="grid grid-cols-12 gap-2 p-3 bg-gray-50 rounded-lg">
                                                            <input
                                                                type="text"
                                                                placeholder="Description"
                                                                value={item.description}
                                                                onChange={(e) => updateInvoiceItem(i, 'description', e.target.value)}
                                                                className="col-span-12 md:col-span-6 px-3 py-2 border rounded-lg"
                                                            />
                                                            <input
                                                                type="number"
                                                                placeholder="Qty"
                                                                value={item.quantity}
                                                                onChange={(e) => updateInvoiceItem(i, 'quantity', e.target.value)}
                                                                className="col-span-4 md:col-span-2 px-3 py-2 border rounded-lg"
                                                                min="0"
                                                            />
                                                            <input
                                                                type="number"
                                                                placeholder="Rate (¬£)"
                                                                value={item.rate}
                                                                onChange={(e) => updateInvoiceItem(i, 'rate', e.target.value)}
                                                                className="col-span-4 md:col-span-2 px-3 py-2 border rounded-lg"
                                                                min="0"
                                                                step="0.01"
                                                            />
                                                            <div className="col-span-3 md:col-span-1 flex items-center justify-end">
                                                                <span className="text-sm font-bold text-green-600">
                                                                    ¬£{(item.quantity * item.rate).toFixed(2)}
                                                                </span>
                                                            </div>
                                                            {invoiceForm.items.length > 1 && (
                                                                <button
                                                                    onClick={() => removeInvoiceItem(i)}
                                                                    className="col-span-1 text-red-600 hover:text-red-800 flex items-center justify-center"
                                                                    title="Remove item"
                                                                >
                                                                    <Trash />
                                                                </button>
                                                            )}
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>

                                            <div>
                                                <label className="block text-sm font-bold text-gray-700 mb-2">Notes</label>
                                                <textarea
                                                    value={invoiceForm.notes}
                                                    onChange={(e) => updateInvoiceField('notes', e.target.value)}
                                                    rows="3"
                                                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                    placeholder="Additional notes or payment terms..."
                                                />
                                            </div>

                                            <div className="bg-gradient-to-r from-purple-50 to-purple-100 p-6 rounded-xl border-2 border-purple-200">
                                                <div className="flex justify-end">
                                                    <div className="w-full md:w-80 space-y-3">
                                                        <div className="flex justify-between text-lg">
                                                            <span className="font-semibold">Subtotal:</span>
                                                            <span className="font-bold">¬£{calculateTotal().subtotal.toFixed(2)}</span>
                                                        </div>
                                                        <div className="flex justify-between text-lg">
                                                            <span className="font-semibold">VAT (20%):</span>
                                                            <span className="font-bold">¬£{calculateTotal().vat.toFixed(2)}</span>
                                                        </div>
                                                        <div className="flex justify-between border-t-2 border-purple-300 pt-3">
                                                            <span className="font-bold text-xl">Total:</span>
                                                            <span className="font-bold text-2xl text-purple-600">
                                                                ¬£{calculateTotal().total.toFixed(2)}
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div className="flex gap-3 pt-4">
                                                <button
                                                    onClick={saveInvoice}
                                                    className="flex-1 btn-primary text-white py-4 rounded-lg font-bold text-lg hover:shadow-lg transition"
                                                >
                                                    üíæ Save Invoice
                                                </button>
                                                <button
                                                    onClick={closeModal}
                                                    className="flex-1 bg-gray-200 text-gray-800 py-4 rounded-lg font-bold text-lg hover:bg-gray-300 transition"
                                                >
                                                    Cancel
                                                </button>
                                            </div>
                                        </div>
                                    )}

                                    {/* INQUIRY FORM */}
                                    {modalType === 'inquiry' && (
                                        <form onSubmit={saveInquiry} className="space-y-6">
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div>
                                                    <label className="block text-sm font-bold text-gray-700 mb-2">Name *</label>
                                                    <input
                                                        type="text"
                                                        name="name"
                                                        defaultValue={editingItem?.name}
                                                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                        required
                                                        placeholder="Customer name"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-bold text-gray-700 mb-2">Phone *</label>
                                                    <input
                                                        type="text"
                                                        name="phone"
                                                        defaultValue={editingItem?.phone}
                                                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                        required
                                                        placeholder="Contact number"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-bold text-gray-700 mb-2">Email</label>
                                                    <input
                                                        type="email"
                                                        name="email"
                                                        defaultValue={editingItem?.email}
                                                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                        placeholder="Email address"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-bold text-gray-700 mb-2">Location *</label>
                                                    <input
                                                        type="text"
                                                        name="location"
                                                        defaultValue={editingItem?.location}
                                                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                        required
                                                        placeholder="Site location"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-bold text-gray-700 mb-2">Date *</label>
                                                    <input
                                                        type="date"
                                                        name="date"
                                                        defaultValue={editingItem?.date || new Date().toISOString().split('T')[0]}
                                                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                        required
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-bold text-gray-700 mb-2">Status</label>
                                                    <select
                                                        name="status"
                                                        defaultValue={editingItem?.status || 'new'}
                                                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                    >
                                                        <option value="new">New</option>
                                                        <option value="contacted">Contacted</option>
                                                        <option value="quoted">Quoted</option>
                                                        <option value="completed">Completed</option>
                                                    </select>
                                                </div>
                                                <div className="md:col-span-2">
                                                    <label className="block text-sm font-bold text-gray-700 mb-2">Quote Amount (¬£)</label>
                                                    <input
                                                        type="number"
                                                        name="quoteAmount"
                                                        step="0.01"
                                                        min="0"
                                                        defaultValue={editingItem?.quoteAmount}
                                                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                        placeholder="Enter quote amount if applicable"
                                                    />
                                                </div>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-bold text-gray-700 mb-2">Notes</label>
                                                <textarea
                                                    name="notes"
                                                    defaultValue={editingItem?.notes}
                                                    rows="4"
                                                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                    placeholder="Details about the inquiry, requirements, follow-up notes..."
                                                />
                                            </div>
                                            <div className="flex gap-3 pt-4">
                                                <button
                                                    type="submit"
                                                    className="flex-1 btn-primary text-white py-4 rounded-lg font-bold text-lg hover:shadow-lg transition"
                                                >
                                                    üíæ Save Inquiry
                                                </button>
                                                <button
                                                    type="button"
                                                    onClick={closeModal}
                                                    className="flex-1 bg-gray-200 text-gray-800 py-4 rounded-lg font-bold text-lg hover:bg-gray-300 transition"
                                                >
                                                    Cancel
                                                </button>
                                            </div>
                                        </form>
                                    )}

                                    {/* VEHICLE FORM */}
                                    {modalType === 'vehicle' && (
                                        <form onSubmit={saveVehicle} className="space-y-6">
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div>
                                                    <label className="block text-sm font-bold text-gray-700 mb-2">Registration *</label>
                                                    <input
                                                        type="text"
                                                        name="registration"
                                                        defaultValue={editingItem?.registration}
                                                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg uppercase focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                        required
                                                        placeholder="e.g., AB12 XYZ"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-bold text-gray-700 mb-2">Owner Name *</label>
                                                    <input
                                                        type="text"
                                                        name="ownerName"
                                                        defaultValue={editingItem?.ownerName}
                                                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                        required
                                                        placeholder="Vehicle owner's name"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-bold text-gray-700 mb-2">Insurance Company *</label>
                                                    <input
                                                        type="text"
                                                        name="insuranceName"
                                                        defaultValue={editingItem?.insuranceName}
                                                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                        required
                                                        placeholder="e.g., Direct Line, AXA"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-bold text-gray-700 mb-2">MOT Due *</label>
                                                    <input
                                                        type="date"
                                                        name="motDue"
                                                        defaultValue={editingItem?.motDue}
                                                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                        required
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-bold text-gray-700 mb-2">Tax Due *</label>
                                                    <input
                                                        type="date"
                                                        name="taxDue"
                                                        defaultValue={editingItem?.taxDue}
                                                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                        required
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-bold text-gray-700 mb-2">Tacho Due *</label>
                                                    <input
                                                        type="date"
                                                        name="tachoDue"
                                                        defaultValue={editingItem?.tachoDue}
                                                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                        required
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-bold text-gray-700 mb-2">Insurance Due *</label>
                                                    <input
                                                        type="date"
                                                        name="insuranceDue"
                                                        defaultValue={editingItem?.insuranceDue}
                                                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                        required
                                                    />
                                                </div>
                                            </div>
                                            <div className="flex gap-3 pt-4">
                                                <button
                                                    type="submit"
                                                    className="flex-1 btn-primary text-white py-4 rounded-lg font-bold text-lg hover:shadow-lg transition"
                                                >
                                                    üíæ Save Vehicle
                                                </button>
                                                <button
                                                    type="button"
                                                    onClick={closeModal}
                                                    className="flex-1 bg-gray-200 text-gray-800 py-4 rounded-lg font-bold text-lg hover:bg-gray-300 transition"
                                                >
                                                    Cancel
                                                </button>
                                            </div>
                                        </form>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<Dashboard />, document.getElementById('root'));
    </script>
</body>
</html>
